<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>FactTok Home</title>

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#7f13ec",
            "background-light": "#f7f6f8",
            "background-dark": "#191022",
          },
          fontFamily: {
            display: ["Spline Sans"],
          },
          borderRadius: { DEFAULT: "0.5rem", lg: "1rem", xl: "1.5rem", full: "9999px" },
        },
      },
    }
  </script>

  <style>
    html, body { overflow-x: hidden; }
    .material-symbols-outlined {
      font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24;
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
  <div class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="p-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Hello, Ryan üî•</h1>
      <a href="nav2_settings.html" class="w-12 h-12 flex items-center justify-center rounded-full bg-primary/10 dark:bg-primary/20 text-primary">
        <span class="material-symbols-outlined text-3xl">account_circle</span>
      </a>
    </header>

    <!-- Main -->
    <main class="flex-grow px-4 space-y-6 pb-6">

      <!-- Input card -->
      <div class="bg-background-light dark:bg-background-dark/50 p-1.5 rounded-xl shadow-sm border border-white/10 dark:border-white/5">
        <div class="flex overflow-hidden rounded-xl">
          <button id="tab-url"  type="button" class="flex-1 py-3 text-sm font-bold text-white bg-primary transition-all duration-200">URL</button>
          <button id="tab-text" type="button" class="flex-1 py-3 text-sm font-bold text-gray-500 dark:text-gray-400 transition-all duration-200">Text</button>
        </div>

        <div class="p-4 space-y-4">
          <div class="relative flex items-center">
            <input id="claim-input" class="form-input w-full pl-11 pr-11 py-4 rounded-lg bg-gray-200/50 dark:bg-black/20 border-transparent focus:border-primary focus:ring-primary placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white" type="text" placeholder="Paste TikTok URL or caption..." />
            <span id="input-icon" class="material-symbols-outlined absolute left-3 text-gray-400 dark:text-gray-500">link</span>
            <div class="group absolute right-3">
              <span class="material-symbols-outlined text-gray-400 dark:text-gray-500 cursor-help">info</span>
              <div class="absolute bottom-full mb-2 w-48 bg-gray-800 text-white text-xs rounded-lg p-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none -translate-x-1/2 left-1/2">
                We‚Äôll extract claims, fact-check, and explain in teen-friendly language.
                <div class="absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-gray-800"></div>
              </div>
            </div>
          </div>

          <button id="analyze-btn" class="w-full py-4 bg-primary text-white font-bold rounded-lg text-lg bg-gradient-to-r from-purple-500 to-indigo-600 hover:opacity-90 transition-opacity">
            Analyze
          </button>

          <p id="error-msg" class="hidden text-sm text-red-400 font-medium"></p>
        </div>
      </div>

      <!-- Results preview (static demo block kept) -->
      <div class="space-y-3">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Results Preview</h2>
        <div class="bg-white/5 dark:bg-black/20 p-4 rounded-xl space-y-3">
          <p class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
            <span class="text-2xl mr-2">‚ö†Ô∏è</span> The Earth is flat
          </p>
          <a href="nav2_details.html" class="text-sm font-bold text-primary dark:text-purple-400 flex items-center">
            View details
            <span class="material-symbols-outlined text-base">arrow_forward</span>
          </a>
        </div>
      </div>

      <!-- Weekly stats -->
      <div class="space-y-3">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Weekly Stats</h2>
        <div class="bg-primary/10 dark:bg-primary/20 p-5 rounded-xl">
          <p class="text-lg font-semibold text-primary dark:text-purple-300 flex items-center">
            <span class="text-3xl mr-3">üéâ</span> You fact-checked 5 TikToks this week!
          </p>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="sticky bottom-0 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm border-t border-gray-200/50 dark:border-white/10">
      <nav class="flex justify-around p-2">
        <a href="nav2_home.html" class="flex flex-col items-center justify-center w-1/3 py-2 text-primary rounded-full bg-primary/10 dark:bg-primary/20">
          <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1">home</span>
          <span class="text-xs font-bold">Home</span>
        </a>
        <a href="nav2_details.html" class="flex flex-col items-center justify-center w-1/3 py-2 text-gray-500 dark:text-gray-400">
          <span class="material-symbols-outlined">add_box</span>
          <span class="text-xs font-medium">Analyze</span>
        </a>
        <a href="nav2_settings.html" class="flex flex-col items-center justify-center w-1/3 py-2 text-gray-500 dark:text-gray-400">
          <span class="material-symbols-outlined">settings</span>
          <span class="text-xs font-medium">Settings</span>
        </a>
        <a href="nav2_history.html" class="flex flex-col items-center justify-center w-1/3 py-2 text-gray-500 dark:text-gray-400">
          <span class="material-symbols-outlined">history</span>
          <span class="text-xs font-medium">History</span>
        </a>
      </nav>
      <div class="h-safe-area-bottom"></div>
    </footer>
  </div>

  <!-- Logic -->
  <script>
    // ---- Tabs ----
    const tabs = { url: document.getElementById('tab-url'), text: document.getElementById('tab-text') };
    const input = document.getElementById('claim-input');
    const icon  = document.getElementById('input-icon');
    const errEl = document.getElementById('error-msg');

    function setActive(mode) {
      const isURL = mode === 'url';

      tabs.url.classList.toggle('bg-primary', isURL);
      tabs.url.classList.toggle('text-white', isURL);
      tabs.url.classList.toggle('text-gray-500', !isURL);
      tabs.url.classList.toggle('dark:text-gray-400', !isURL);

      tabs.text.classList.toggle('bg-primary', !isURL);
      tabs.text.classList.toggle('text-white', !isURL);
      tabs.text.classList.toggle('text-gray-500', isURL);
      tabs.text.classList.toggle('dark:text-gray-400', isURL);

      input.placeholder = isURL ? 'Paste TikTok URL...' : 'Type caption or claim...';
      icon.textContent  = isURL ? 'link' : 'text_fields';
      input.dataset.mode = mode;
    }
    tabs.url.addEventListener('click', () => setActive('url'));
    tabs.text.addEventListener('click', () => setActive('text'));
    setActive('url'); // default

    // ---- API Call ----
    const API_BASE = 'http://127.0.0.1:8000'; // change for deployment (e.g., '' if same origin)

    async function analyze(userText) {
      const res = await fetch(`${API_BASE}/verify-claim/`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userInput: userText })
      });
      if (!res.ok) throw new Error('API error: ' + res.status);
      return await res.json();
    }

    const btn = document.getElementById('analyze-btn');
    btn.addEventListener('click', async () => {
      errEl.classList.add('hidden');
      const userText = (input.value || '').trim();
      if (!userText) {
        errEl.textContent = 'Please enter a URL, caption, or claim.';
        errEl.classList.remove('hidden');
        return;
      }

      btn.disabled = true;
      const original = btn.textContent;
      btn.textContent = 'Analyzing‚Ä¶';

      try {
        const data = await analyze(userText);
        localStorage.setItem('facttok_result', JSON.stringify(data));

        // optional: add to local history
        try {
          const hist = JSON.parse(localStorage.getItem('facttok_history') || '[]');
          hist.unshift({ ts: Date.now(), claim: data.generatedClaim || userText, verdicts: data.verificationResults || [] });
          localStorage.setItem('facttok_history', JSON.stringify(hist.slice(0, 50)));
        } catch {}

        window.location.href = 'nav2_details.html';
      } catch (e) {
        errEl.textContent = e.message || 'Something went wrong. Try again.';
        errEl.classList.remove('hidden');
      } finally {
        btn.disabled = false;
        btn.textContent = original;
      }
    });
  </script>
</body>
</html>
